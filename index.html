<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Aurora Now</title>
    <link rel="manifest" href="manifest.webmanifest" />
    <meta name="theme-color" content="#020617" />
    <link rel="apple-touch-icon" href="pagelogo.png" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <meta
      name="description"
      content="Aurora Now helps you see at-a-glance if there’s a realistic chance of aurora from your location, factoring in KP, distance from the auroral oval, light pollution, clouds, Moon and darkness."
    />

    <!-- Icons / branding -->
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="apple-touch-icon" href="pagelogo.png" />
    <meta name="theme-color" content="#020816" />

    <!-- Base styles -->
    <link rel="stylesheet" href="styles.css" />

    <!-- Aurora Now theme overrides (sit on top of styles.css) -->
    <style>
      :root {
        --aurora-bg: #020816;
        --aurora-bg-alt: #041528;
        --aurora-card-bg: rgba(5, 18, 33, 0.96);
        --aurora-card-border: rgba(88, 255, 195, 0.35);
        --aurora-accent: #3cfba6;
        --aurora-accent-soft: rgba(60, 251, 166, 0.15);
        --aurora-text-main: #f8fbff;
        --aurora-text-muted: #a6bfd4;
        --aurora-badge-bg: rgba(10, 167, 122, 0.3);
      }

      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      html,
      body {
        background: radial-gradient(
          circle at top,
          #0b2340 0%,
          #020816 55%,
          #01040f 100%
        );
        color: var(--aurora-text-main);
        color-scheme: dark;
        margin: 0;
        padding: 0;
        overflow-x: hidden; /* prevent tiny horizontal scroll on mobile */
      }

      .app-shell {
        width: 100%;
        max-width: 1100px;
        margin: 0 auto;
        padding: 24px 16px 32px;
      }

      .app-header {
        margin-bottom: 24px;
      }

      .app-header-inner {
        display: flex;
        justify-content: space-between;
        gap: 16px;
        align-items: center;
        flex-wrap: wrap;
      }

      .app-brand {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .app-logo {
        width: 72px;
        height: auto;
        border-radius: 16px;
        box-shadow: 0 10px 35px rgba(0, 0, 0, 0.45);
      }

      .app-title {
        font-size: clamp(2rem, 3vw, 2.6rem);
        margin: 0;
      }

      .app-subtitle {
        margin: 4px 0 0;
        color: var(--aurora-text-muted);
      }

      .header-meta {
        text-align: right;
      }

      .footer-time {
        color: var(--aurora-text-muted);
      }

      .card,
      section.card {
        background: linear-gradient(
          145deg,
          var(--aurora-card-bg),
          rgba(2, 16, 33, 0.96)
        );
        border-radius: 18px;
        border: 1px solid var(--aurora-card-border);
        box-shadow: 0 16px 40px rgba(0, 0, 0, 0.6);
      }

      button,
      .btn,
      input[type="button"],
      input[type="submit"] {
        background: linear-gradient(135deg, #42ffb4, #1ddba0);
        border: none;
        color: #001019;
        border-radius: 999px;
        padding: 7px 14px;
        font-weight: 500;
        cursor: pointer;
      }

      button:hover,
      .btn:hover,
      input[type="button"]:hover,
      input[type="submit"]:hover {
        filter: brightness(1.05);
      }

      input[type="range"] {
        accent-color: var(--aurora-accent);
      }

      .chip,
      .badge {
        background: var(--aurora-badge-bg);
        border-color: rgba(121, 255, 202, 0.4);
        color: var(--aurora-text-main);
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <header class="app-header">
        <div class="app-header-inner">
          <div class="app-brand">
            <img
              src="pagelogo.png"
              alt="Aurora Now logo"
              class="app-logo"
            />
            <div>
              <h1 class="app-title">Aurora Now</h1>
              <p class="app-subtitle">
                See at-a-glance if there’s a realistic chance of aurora
                from where you are.
              </p>
            </div>
          </div>
          <div class="header-meta">
            <p id="footer-time" class="footer-time">
              Detecting your local time…
            </p>
          </div>
        </div>
      </header>

      <main class="app-main">
        <!-- LOCATION & CONTROLS -->
        <section class="card card-location">
          <div class="card-header">
            <h2 class="card-title">Where are we scoring?</h2>
            <p class="card-subtitle">
              We try your device GPS first, then fall back to IP location
              or a dark-sky default if needed.
            </p>
          </div>

          <div class="card-body location-grid">
            <div class="location-text">
              <div id="location-main" class="location-main">
                Detecting location…
              </div>
              <div id="location-detail" class="location-detail">
                Trying device GPS first, then IP-based location, or a
                dark-sky fallback on the Isle of Rùm.
              </div>
              <div id="location-meta" class="location-meta"></div>
            </div>

            <div class="location-controls">
              <div class="location-buttons">
                <button id="gps-button" class="btn btn-primary">
                  Use device GPS / IP
                </button>
              </div>

              <div class="location-search">
                <label class="field-label" for="search-input">
                  Or search for a place
                </label>
                <div class="search-row">
                  <input
                    id="search-input"
                    class="input"
                    type="text"
                    placeholder="e.g. Tromsø, Atacama Desert, London"
                    autocomplete="off"
                  />
                  <button id="search-button" class="btn btn-secondary">
                    Search
                  </button>
                </div>
                <p class="field-hint">
                  You can search for cities, towns, or known dark-sky
                  sites.
                </p>
              </div>
            </div>
          </div>
        </section>

        <!-- KP & LIGHT POLLUTION -->
<section class="card card-kp-lp">
  <div class="card-body kp-lp-grid">
    <div class="kp-column">
      <h2 class="card-title">Geomagnetic activity (KP)</h2>
      <p class="card-subtitle">
        We auto-load the latest KP estimate from NOAA’s live aurora
        prediction feed. Use the slider below to override it if
        needed.
      </p>

      <div class="kp-control">
        <label class="field-label" for="kp-input">KP index</label>
        <input
          id="kp-input"
          type="range"
          min="0"
          max="9"
          step="0.1"
          value="3.5"
        />
        <div id="kp-value" class="kp-value">KP 3.5</div>
      </div>

      <p class="field-hint">
        Rough guide: KP 2–3 = typical background, 4–5 = active,
        6+ = storm level.
      </p>

      <div class="kp-live-row">
        <label class="kp-live-toggle">
          <input type="checkbox" id="kp-live-toggle" />
          Use live NOAA KP (beta)
        </label>
        <div id="kp-live-status" class="kp-live-status"></div>
      </div>
    </div>

    <div class="lp-column">

            <div class="lp-column">
              <h2 class="card-title">
                Sky brightness (light pollution)
              </h2>
              <p class="card-subtitle">
                We estimate light pollution from your coordinates and,
                where available, a precomputed light-pollution grid. You
                can override it if you know your local sky.
              </p>

              <div
                class="lp-badge-wrapper"
                data-role="light-pollution-badge"
              >
                <div class="lp-badge-text">
                  <span class="lp-badge-label-strong"
                    >Light pollution:</span
                  >
                  <span class="lp-badge-label">estimating…</span>
                </div>
                <div class="lp-indicator">
                  <div class="lp-indicator-inner"></div>
                </div>
              </div>

              <div id="lp-mode-options" class="lp-mode-options">
                <button
                  type="button"
                  class="lp-mode-btn lp-mode-btn-active"
                  data-mode="auto"
                >
                  Auto
                </button>
                <button
                  type="button"
                  class="lp-mode-btn"
                  data-mode="dark"
                >
                  Dark rural
                </button>
                <button
                  type="button"
                  class="lp-mode-btn"
                  data-mode="suburban"
                >
                  Suburban
                </button>
                <button
                  type="button"
                  class="lp-mode-btn"
                  data-mode="urban"
                >
                  Urban / city
                </button>
              </div>

              <p id="lp-mode-hint" class="field-hint">
                Auto is a rough guess from your location and, where
                available, a precomputed light-pollution grid. Adjust if
                you know your local sky.
              </p>
            </div>
          </div>
        </section>

        <!-- MAIN SCORE & TONIGHT SUMMARY -->
        <section class="layout-two-column">
          <!-- MAIN VERDICT CARD -->
          <article
            class="card card-verdict"
            data-role="aurora-verdict"
          >
            <div class="card-header">
              <h2 class="card-title">Aurora visibility from here</h2>
              <p class="card-subtitle">
                Takes into account KP, your distance from the auroral
                oval, sky brightness, a simple clouds and Moon model, and
                local darkness.
              </p>
            </div>

            <div class="card-body">
              <p id="verdict-text" class="verdict-text">
                Calculating your chances…
              </p>
              <p id="verdict-score" class="verdict-score">
                Score — / 100
              </p>

              <ul
                data-role="aurora-debug"
                class="debug-list"
              ></ul>
            </div>
          </article>

          <!-- TONIGHT PANEL -->
          <article class="card card-tonight">
            <div class="card-header">
              <h2 id="tonight-title" class="card-title">
                Tonight at your location
              </h2>
              <p
                id="tonight-location-sub"
                class="card-subtitle"
              >
                Tonight’s view based on current KP and a simple sky
                model.
              </p>
            </div>

            <div class="card-body tonight-body">
              <div class="tonight-main">
                <div
                  id="tonight-chance"
                  class="tonight-chance chance-low"
                >
                  Low chance
                </div>
                <p
                  id="tonight-geomag"
                  class="tonight-geomag"
                >
                  Geomagnetic activity is based on the KP slider and your
                  latitude; clouds and Moon are included using simple v1
                  models.
                </p>

                <div class="chip-row">
                  <span class="chip" id="chip-aurora">
                    Aurora activity
                  </span>
                  <span class="chip" id="chip-darkness">
                    Darkness window
                  </span>
                  <span class="chip" id="chip-clouds">
                    Clouds
                  </span>
                  <span class="chip" id="chip-moon">
                    Moon
                  </span>
                </div>
              </div>

              <div class="tonight-details">
                <div class="tonight-detail-block">
                  <h3 class="detail-title">Darkness</h3>
                  <p
                    id="detail-darkness"
                    class="detail-text"
                  >
                    We’ll estimate your dark window once we know your
                    location.
                  </p>
                </div>

                <div class="tonight-detail-block">
                  <h3 class="detail-title">Clouds</h3>
                  <p
                    id="detail-clouds"
                    class="detail-text"
                  >
                    Right now we use a simple fixed cloud cover value
                    that feeds into the score. In a full version this
                    will come from a weather API and vary by hour.
                  </p>
                </div>

                <div class="tonight-detail-block">
                  <h3 class="detail-title">Moon</h3>
                  <p
                    id="detail-moon"
                    class="detail-text"
                  >
                    We use an approximate Moon phase model to estimate
                    how much the Moon brightens the sky. In this v1 it
                    reduces the score slightly when the Moon is bright,
                    especially during dark hours.
                  </p>
                </div>
              </div>
            </div>
          </article>
        </section>

        <!-- NEXT DARK HOURS -->
        <section class="card card-next-dark">
          <div class="card-header">
            <h2 class="card-title">Next dark hours</h2>
            <p
              id="next-dark-subtitle"
              class="card-subtitle"
            >
              Estimated viewing score over key dark hours, combining KP,
              location, light pollution, simple clouds and Moon phase.
            </p>
          </div>

          <div class="card-body">
            <div id="hourly-bar" class="hourly-bar">
              <!-- JS will populate hour blocks here -->
            </div>
          </div>
        </section>

        <!-- LIVE AURORA DATA -->
        <section class="card card-aurora-data">
          <div class="card-header">
            <h2 class="card-title">Live aurora oval (NOAA)</h2>
            <p class="card-subtitle">
              Real-time OVATION auroral oval forecast direct from NOAA’s
              Space Weather Prediction Center.
            </p>
          </div>

          <div class="card-body aurora-oval-body">
            <div class="aurora-oval-meta">
              <p id="aurora-oval-status" class="aurora-oval-status">
                Fetching latest NOAA aurora image…
              </p>
              <button
                type="button"
                class="btn btn-secondary"
                id="aurora-oval-refresh"
              >
                Refresh now
              </button>
            </div>

            <div class="aurora-oval-frame">
              <img
                id="aurora-oval-img"
                alt="NOAA OVATION auroral oval forecast"
                loading="lazy"
              />
              <p class="aurora-oval-caption">
                Image source: NOAA SWPC OVATION Prime auroral oval. The model
                updates roughly every 5 minutes with real geomagnetic inputs.
              </p>
            </div>
          </div>
        </section>

        <!-- DATA STATUS / EXPLANATORY PANELS -->
        <section class="card card-status">
          <div class="card-header">
            <h2 class="card-title">Data status</h2>
            <p class="card-subtitle">
              What’s currently wired in, and what’s still a placeholder.
            </p>
          </div>
          <div class="card-body">
            <ul class="status-list">
              <li>
                <strong>Light pollution</strong> is automatically
                estimated from your coordinates, using a World Atlas
                brightness grid when available and a heuristic fallback
                otherwise. You can still override the sky brightness
                manually.
              </li>
              <li>
                <strong>Darkness windows</strong> use live
                sunrise/sunset times from sunrise-sunset.org with a
                solar-model fallback, and feed both the main score and
                the “Next dark hours” view.
              </li>
              <li>
                <strong>Clouds</strong> are assumed “mostly clear” (~20%
                cover) for now; live weather data per hour is still to
                come.
              </li>
              <li>
                The <strong>Moon</strong> uses an internal
                phase/illumination model to reduce the score when the
                Moon is bright. A future version will refine this with
                altitude-aware ephemeris data.
              </li>
              <li>
                <strong>Aurora oval</strong> imagery is live from NOAA
                SWPC’s OVATION model and updates roughly every five
                minutes.
              </li>
              <li>
                Your <strong>location</strong> is pulled from device GPS
                when permitted, falls back to IP-based lookup, and uses a
                dark-sky default on the Isle of Rùm if nothing else
                works.
              </li>
            </ul>
          </div>
        </section>

        <section class="info-grid">
          <article class="card info-card">
            <div class="card-header">
              <h2 class="card-title">Aurora activity</h2>
            </div>
            <div class="card-body">
              <p>
                KP is a global index of geomagnetic activity. Higher KP
                means the auroral oval expands further from the poles.
                In this prototype you control KP with the slider, which
                drives both the main score and the hourly strip.
              </p>
            </div>
          </article>

          <article class="card info-card">
            <div class="card-header">
              <h2 class="card-title">Clouds</h2>
            </div>
            <div class="card-body">
              <p>
                Cloud cover will eventually be pulled from a weather
                API. For now we assume “mostly clear (20%)” and feed
                that into both the main score and the hourly chart.
              </p>
            </div>
          </article>

          <article class="card info-card">
            <div class="card-header">
              <h2 class="card-title">Moon</h2>
            </div>
            <div class="card-body">
              <p>
                We approximate Moon phase and brightness and use this to
                slightly reduce the score when the Moon is bright during
                dark hours. In a future version we’ll also account for
                Moon altitude and more detailed sky brightness.
              </p>
            </div>
          </article>

          <article class="card info-card">
            <div class="card-header">
              <h2 class="card-title">Darkness</h2>
            </div>
            <div class="card-body">
              <p>
                We use a simple solar model (civil, nautical and
                astronomical twilight plus sunset/sunrise) to define
                when the sky is dark enough. This feeds into both the
                main score and the “Next dark hours” bar chart.
              </p>
            </div>
          </article>

          <article class="card info-card">
            <div class="card-header">
              <h2 class="card-title">Light pollution</h2>
            </div>
            <div class="card-body">
              <p>
                We estimate light pollution from your
                latitude/longitude and, when available, a precomputed
                light-pollution grid. You can override this using the
                sky brightness control above; all of this feeds into the
                visibility score.
              </p>
            </div>
          </article>
        </section>
      </main>

      <footer class="app-footer">
        <p class="footer-credit">
          Aurora Now is a prototype aurora helper – scores are
          approximate and for personal interest only.
        </p>
      </footer>
    </div>

    <script src="app.js"></script>
  </body>
</html>
